sudo: true
language: python
env:
  matrix:
    - SERVICE=authproxy CXX=g++-4.8 CC=gcc-4.8
before_install:
  - . $HOME/.nvm/nvm.sh
  - nvm install stable
  - nvm use stable
  # See https://github.com/travis-ci/travis-ci/issues/538
  - '[ "$CXX" != "" ] && sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y'
  - '[ "$CXX" != "" ] && sudo apt-get update -qq'
  - '[ "$CXX" != "" ] && sudo apt-get install -qq $CXX'
install:
  - bash -c "cd services/$SERVICE; ./test/install.sh"
before_script:
  - bash -c "cd services/$SERVICE; cp localsettings.yml.example localsettings.yml"
  - bash -c "cd services/$SERVICE; ./test/before_script.sh"
script:
  - bash -c "cd services/$SERVICE; ./test/script.sh"
after_script:
  - bash -c "cd services/$SERVICE; ./test/after_script.sh"
services:
  - couchdb
